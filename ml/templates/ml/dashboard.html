{% extends 'base.html' %} 
{% load static %}
{% block content %}
<section class="content">
  <div class="row">
    <!-- Welcome user -->
    <div class="col-12">
      <div class="box">
        <div class="box-body">
          <div class="d-md-flex justify-content-between align-items-center">
            <div class="col-lg-8 offset-lg-2">
              <h2 class="text-center mb-4">
                Welcome {{user.first_name.title}}
              </h2>
              <p class="text-center mb-4">
                Welcome to your dashboard. Here you can see an overview of your system and breast cancer risk assessments.
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Dashboard -->
    <div class="container">
      <div class="row">
        <!-- Total Users -->
        <div class="col-xl-3 col-lg-6 col-sm-6 col-12">
            <div class="box mb-15 pull-up hover-success">
                <div class="box-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <button type="button" class="waves-effect waves-light btn btn-rounded btn-dark mb-5">
                                <i data-feather="users"></i> Total Users
                            </button>
                        </div>
                        <div>
                            <div class="d-flex flex-column font-weight-500">
                                <a href="#" class="text-dark text-end hover-primary mb-1 fs-16">User Growth</a>
                                <span class="text-success">+3.4%</span>
                            </div>
                        </div>
                    </div>
                    <div class="row align-items-center mt-10">
                        <div class="col-6">
                            <p class="text-muted fw-normal m-0 text-muted" title="Total Users">Total Users</p>
                            <h3 class="m-0 fw-600">{{ total_users }}</h3>
                        </div>
                        <div class="col-6">
                            <div class="text-end" style="position: relative;">
                                <div id="user-chart" style="min-height: 70px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Users -->
        <div class="col-xl-3 col-lg-6 col-sm-6 col-12">
            <div class="box mb-15 pull-up hover-success">
                <div class="box-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <button type="button" class="waves-effect waves-light btn btn-rounded btn-danger mb-5">
                                <i data-feather="user-check"></i> Active Users
                            </button>
                        </div>
                        <div>
                            <div class="d-flex flex-column font-weight-500">
                                <a href="#" class="text-danger text-end hover-primary mb-1 fs-16">Active Users</a>
                            </div>
                        </div>
                    </div>
                    <div class="row align-items-center mt-10">
                        <div class="col-6">
                            <p class="text-muted fw-normal m-0 text-muted" title="Active Users">Active Users</p>
                            <h3 class="m-0 fw-600">{{ active_users }}</h3>
                        </div>
                        <div class="col-6">
                            <div class="text-end" style="position: relative;">
                                <div id="active-users-chart" style="min-height: 70px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Assessments -->
        <div class="col-xl-3 col-lg-6 col-sm-6 col-12">
            <div class="box mb-15 pull-up hover-success">
                <div class="box-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <button type="button" class="waves-effect waves-light btn btn-rounded btn-success mb-5">
                                <i data-feather="file-text"></i> Records
                            </button>
                        </div>
                        <div>
                            <div class="d-flex flex-column font-weight-500">
                                <a href="#" class="text-success text-end hover-primary mb-1 fs-16">Assessments</a>
                            </div>
                        </div>
                    </div>
                    <div class="row align-items-center mt-10">
                        <div class="col-6">
                            <p class="text-muted fw-normal m-0 text-muted" title="Total Assessments">Total Assessments</p>
                            <h3 class="m-0 fw-600">{{ total_assessments }}</h3>
                        </div>
                        <div class="col-6">
                            <div class="text-end" style="position: relative;">
                                <div id="assessments-chart" style="min-height: 70px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Signups -->
        <div class="col-xl-3 col-lg-6 col-sm-6 col-12">
            <div class="box mb-15 pull-up hover-success">
                <div class="box-body">
                    <div class="d-flex align-items-center justify-content-between">
                        <div class="d-flex align-items-center">
                            <button type="button" class="waves-effect waves-light btn btn-rounded btn-info mb-5">
                                <i data-feather="user-plus"></i> Signups
                            </button>
                        </div>
                        <div>
                            <div class="d-flex flex-column font-weight-500">
                                <a href="#" class="text-dark text-end hover-primary mb-1 fs-16">Recent Signups</a>
                            </div>
                        </div>
                    </div>
                    <div class="row align-items-center mt-10">
                        <div class="col-6">
                            <p class="text-muted fw-normal m-0 text-muted" title="Recent Signups">Total Signups</p>
                            <h3 class="m-0 fw-600">{{ recent_signups }}</h3>
                        </div>
                        <div class="col-6">
                            <div class="text-end" style="position: relative;">
                                <div id="signups-chart" style="min-height: 70px;"></div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

      </div>
      <div class="row mt-3">
        <div class="col-md-6">
          <div class="card">
            <div class="card-header bg-secondary text-white">
                Recent Activities
            </div>
            <div class="card-body">
                <ul>
                    {% for activity in recent_activities %}
                        <li>{{ activity.full_name|title }} - {{ activity.action }}</li>
                    {% empty %}
                        <li>No recent activities yet.</li>
                    {% endfor %}
                </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Health Overview -->
    <div class="col-12">
      {% if result %}
        <div class="box">
          <div class="box-body">
            <div class="d-md-flex justify-content-between align-items-center">
              <div>
                <p>
                  <span class="text-primary">Result</span> |
                  <span class="text-fade">Health Overview</span>
                </p>
                <h3 class="mb-0 fw-500">Summary of your health info.</h3>
              </div>
              <div class="mt-10 mt-md-0">
                <a  onclick="navigateToUrl(this)"
                    data-url="{% url 'detailed_result' result.pk %}"
                    href="javascript:void(0)"
                  class="waves-effect waves-light btn btn-outline btn-primary"
                  >View Now</a
                >
              </div>
            </div>
            <hr />
            <div class="d-md-flex justify-content-between align-items-center">
              <div class="d-flex justify-content-start align-items-center">
                <div class="min-w-100">
                  <p class="mb-0 text-fade">Last Assessment Date</p>
                  <h6 class="mb-0">{{result.submission_date}}</h6>
                </div>
                <div class="mx-lg-50 mx-20 min-w-70">
                  <p class="mb-0 text-fade">Recommendations</p>
                  <h6 class="mb-0 text-success">
                    {{result.get_risk_level}}
                  </h6>
                </div>
                <div>
                  <p class="mb-0 text-fade">Risk</p>
                  <h6 class="mb-0">{{result.risk_level}}</h6>
                </div>
              </div>
              <div class="mt-10 mt-md-0">
                <a
                  data-bs-toggle="modal" data-bs-target="#deleteModal" 
                  onclick="confirmDelete('{{ result.id }}')"
                  class="waves-effect waves-light btn mb-5 bg-gradient-danger btn-flat"
                  ><i class="fa fa-trash me-10"></i>Delete</a
                >
              </div>
            </div>
          </div>
        </div>
      {% endif %}
    </div>

    <!-- Quick Action -->
    <div class="col-12">
      <div class="box">
        <div class="box-body">
          <div class="container">
            <div
            class="d-md-flex justify-content-between align-items-center mb-20"
            >
              <div>
                <h3 class="mb-0 fw-500">Quick Actions</h3>
              </div>
            </div>
            <div class="d-md-flex justify-content-between align-items-center">
              <a onclick="navigateToUrl(this)"
                    data-url="{% url 'AdminHub:measurement' %}"
                    href="javascript:void(0);" 
                    class="waves-effect waves-light btn btn-primary m-10 p-20"
                >Take Measurement</a>
              <a onclick="navigateToUrl(this)"
                    data-url="{% url 'AdminHub:record_management' %}"
                    href="javascript:void(0);"  class="waves-effect waves-light btn btn-danger m-10 p-20"
                >View Prediction Reports</a
              >
              <a onclick="navigateToUrl(this)"
                    data-url="{% url 'AdminHub:user-list' %}"
                    href="javascript:void(0);" class="waves-effect waves-light btn btn-info m-10 p-20">
                Patients Management
              </a>
              <a onclick="navigateToUrl(this)"
                    data-url="{% url 'AdminHub:system_settings' %}"
                    href="javascript:void(0);" class="waves-effect waves-light btn btn-info m-10 p-20">
                Manage System Settings
              </a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% include 'patients/includes/result-histores-modal.html' %}
</section>

{% endblock content %}


{% block scripts %}
  <script>
    function createChart(selector, chartData, color) {
      var options = {
          series: [{
              data: chartData.data
          }],
          chart: {
              type: 'line',
              width: 100,
              height: 70,
              sparkline: {
                  enabled: true
              }
          },
          stroke: {
              curve: 'smooth',
              width: 2,
          },
          colors: [color],
          tooltip: {
              fixed: {
                  enabled: false
              },
              x: {
                  show: true,
                  formatter: function(value, { series, seriesIndex, dataPointIndex, w }) {
                      return chartData.labels[dataPointIndex];
                  }
              },
              y: {
                  title: {
                      formatter: function (seriesName) {
                          return '';
                      }
                  },
                  formatter: function(value) {
                      return value;
                  }
              },
              marker: {
                  show: false
              }
          },
          xaxis: {
              categories: chartData.labels
          }
      };
      var chart = new ApexCharts(document.querySelector(selector), options);
      chart.render();
    }

    createChart('#user-chart', {{ user_chart_data|safe }},'#f2426d');
    createChart('#active-users-chart', {{ active_users_chart_data|safe }},'#51ce8a');
    createChart('#assessments-chart', {{ assessments_chart_data|safe }},'#fec801');
    createChart('#signups-chart', {{ signups_chart_data|safe }},'#733aeb');

  </script>
{% endblock scripts %}
  